"use strict";(self["webpackChunkweek6and7"]=self["webpackChunkweek6and7"]||[]).push([[485],{5485:function(t,e,a){a.r(e),a.d(e,{default:function(){return Ct}});var l=a(6252),s=a(3577),d=a(9963);const o=(0,l._)("h2",null,"購物車",-1),i={class:"container"},r={class:"mt-4"},n={class:"table align-middle"},c=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",null,"圖片"),(0,l._)("th",null,"商品名稱"),(0,l._)("th",null,"價格"),(0,l._)("th")])],-1),u={style:{width:"200px"}},m={key:0,class:"h5"},p={key:1},h={class:"h6"},g={class:"h5"},_={class:"btn-group btn-group-sm"},b=["onClick"],v=["onClick","disabled"],f={class:"spinner-border spinner-border-sm"},y=(0,l.Uk)(" 加到購物車 "),w={class:"text-end"},C={class:"table align-middle"},k=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th"),(0,l._)("th",null,"品名"),(0,l._)("th",{style:{width:"150px"}},"數量/單位"),(0,l._)("th",null,"單價")])],-1),x=["onClick","disabled"],M={class:"input-group input-group-sm"},$={class:"input-group mb-3"},V=["onUpdate:modelValue","onChange","disabled"],z=["value"],D={class:"input-group-text",id:"basic-addon2"},q={class:"text-end"},L=(0,l._)("td",{colspan:"3",class:"text-end"},"總計",-1),U={class:"text-end"};function W(t,e,a,W,T,P){const F=(0,l.up)("CartModal"),I=(0,l.up)("CartForm");return(0,l.wg)(),(0,l.iD)(l.HY,null,[o,(0,l._)("div",i,[(0,l._)("div",r,[(0,l.Wm)(F,{ref:"CartModal",id:T.productId,onAddToCart:P.addToCart},null,8,["id","onAddToCart"]),(0,l._)("table",n,[c,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(T.products,(t=>((0,l.wg)(),(0,l.iD)("tr",{key:t.id},[(0,l._)("td",u,[(0,l._)("div",{style:(0,s.j5)([{backgroundImage:`url(${t.imageUrl})`},{height:"100px","background-size":"cover","background-position":"center"}])},null,4)]),(0,l._)("td",null,(0,s.zw)(t.title),1),(0,l._)("td",null,[t.price===t.origin_price?((0,l.wg)(),(0,l.iD)("div",m,(0,s.zw)(t.price)+" 元 ",1)):((0,l.wg)(),(0,l.iD)("div",p,[(0,l._)("del",h,"原價 "+(0,s.zw)(t.origin_price)+" 元",1),(0,l._)("div",g,"現在只要 "+(0,s.zw)(t.price)+" 元",1)]))]),(0,l._)("td",null,[(0,l._)("div",_,[(0,l._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e=>P.openModal(t.id)}," 查看更多 ",8,b),(0,l._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>P.addToCart(t.id),disabled:T.isLoading===t.id},[(0,l.wy)((0,l._)("span",f,null,512),[[d.F8,T.isLoading===t.id]]),y],8,v)])])])))),128))])]),(0,l._)("div",w,[(0,l._)("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=t=>P.delCarts())}," 清空購物車 ")]),(0,l._)("table",C,[k,(0,l._)("tbody",null,[T.cartData.carts?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(T.cartData.carts,(t=>((0,l.wg)(),(0,l.iD)("tr",{key:t.id},[(0,l._)("td",null,[(0,l._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>P.delCartItem(t.id),disabled:T.isLoading===t.id}," x ",8,x)]),(0,l._)("td",null,(0,s.zw)(t.product.title),1),(0,l._)("td",null,[(0,l._)("div",M,[(0,l._)("div",$,[(0,l.wy)((0,l._)("select",{id:"",class:"form-select","onUpdate:modelValue":e=>t.qty=e,onChange:e=>P.updateCarts(t),disabled:T.isLoading===t.id},[((0,l.wg)(),(0,l.iD)(l.HY,null,(0,l.Ko)(100,(e=>(0,l._)("option",{value:e,key:`${e}${t.id}`},(0,s.zw)(e),9,z))),64))],40,V),[[d.bM,t.qty]]),(0,l._)("span",D,(0,s.zw)(t.product.unit),1)])])]),(0,l._)("td",q,(0,s.zw)(t.final_total),1)])))),128)):(0,l.kq)("",!0)]),(0,l._)("tfoot",null,[(0,l._)("tr",null,[L,(0,l._)("td",U,(0,s.zw)(T.cartData.total),1)])])])]),(0,l.Wm)(I)])],64)}const T={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"productModal"},P={class:"modal-dialog modal-xl",role:"document"},F={class:"modal-content border-0"},I={class:"modal-header bg-dark text-white"},Z={class:"modal-title",id:"exampleModalLabel"},H=(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},A={class:"row"},K={class:"col-sm-6"},j=["src"],E={class:"col-sm-6"},O={class:"badge bg-primary rounded-pill"},B={key:0,class:"h5"},G={key:1},J={class:"h6"},N={class:"h5"},Q={class:"input-group"};function R(t,e,a,o,i,r){return(0,l.wg)(),(0,l.iD)("div",T,[(0,l._)("div",P,[(0,l._)("div",F,[(0,l._)("div",I,[(0,l._)("h5",Z,[(0,l._)("span",null,(0,s.zw)(i.product.title),1)]),H]),(0,l._)("div",Y,[(0,l._)("div",A,[(0,l._)("div",K,[(0,l._)("img",{class:"img-fluid",src:i.product.imageUrl,alt:""},null,8,j)]),(0,l._)("div",E,[(0,l._)("span",O,(0,s.zw)(i.product.category),1),(0,l._)("p",null,"商品描述："+(0,s.zw)(i.product.description),1),(0,l._)("p",null,"商品內容："+(0,s.zw)(i.product.content),1),i.product.price===i.product.origin_price?((0,l.wg)(),(0,l.iD)("div",B,(0,s.zw)(i.product.price)+" 元 ",1)):((0,l.wg)(),(0,l.iD)("div",G,[(0,l._)("del",J,"原價 "+(0,s.zw)(i.product.origin_price)+" 元",1),(0,l._)("div",N,"現在只要 "+(0,s.zw)(i.product.price)+" 元",1)])),(0,l._)("div",null,[(0,l._)("div",Q,[(0,l.wy)((0,l._)("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":e[0]||(e[0]=t=>i.qty=t)},null,512),[[d.nr,i.qty]]),(0,l._)("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=(...t)=>r.addToCart&&r.addToCart(...t))}," 加入購物車 ")])])])])])])])],512)}var S=a(7244),X={props:["id"],data(){return{productModal:"",product:{},qty:1}},watch:{id(){this.getProduct()}},methods:{openModal(){this.productModal.show()},closeModal(){this.productModal.hide()},getProduct(){this.$http.get(`https://vue3-course-api.hexschool.io/v2/api/mimiluckying/product/${this.id}`).then((t=>{this.product=t.data.product})).catch((t=>{alert(t.data.message)}))},addToCart(){this.$emit("add-to-cart",this.product.id,this.qty),this.closeModal()}},mounted(){this.productModal=new S.u_(this.$refs.productModal)}},tt=a(3744);const et=(0,tt.Z)(X,[["render",R]]);var at=et,lt=a(4902);const st={class:"my-5 row justify-content-center"},dt={class:"mb-3"},ot=(0,l._)("label",{for:"email",class:"form-label"},"Email",-1),it={class:"mb-3"},rt=(0,l._)("label",{for:"name",class:"form-label"},"收件人姓名",-1),nt={class:"mb-3"},ct=(0,l._)("label",{for:"phone",class:"form-label"},"收件人手機",-1),ut={class:"mb-3"},mt=(0,l._)("label",{for:"address",class:"form-label"},"收件人地址",-1),pt={class:"mb-3"},ht=(0,l._)("label",{for:"message",class:"form-label"},"留言",-1),gt={class:"text-end"};function _t(t,e,a,o,i,r){const n=(0,l.up)("VField"),c=(0,l.up)("error-message"),u=(0,l.up)("VForm");return(0,l.wg)(),(0,l.iD)("div",st,[(0,l.Wm)(u,{ref:"form",class:"col-md-6"},{default:(0,l.w5)((({errors:t})=>[(0,l._)("div",dt,[ot,(0,l.Wm)(n,{id:"email",name:"email",type:"email",class:(0,s.C_)(["form-control",{"is-invalid":t["email"]}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:i.form.user.email,"onUpdate:modelValue":e[0]||(e[0]=t=>i.form.user.email=t)},null,8,["class","modelValue"]),(0,l.Wm)(c,{name:"email",class:"invalid-feedback"})]),(0,l._)("div",it,[rt,(0,l.Wm)(n,{id:"name",name:"姓名",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":t["姓名"]}]),placeholder:"請輸入姓名",rules:"required",modelValue:i.form.user.name,"onUpdate:modelValue":e[1]||(e[1]=t=>i.form.user.name=t)},null,8,["class","modelValue"]),(0,l.Wm)(c,{name:"姓名",class:"invalid-feedback"})]),(0,l._)("div",nt,[ct,(0,l.Wm)(n,{id:"phone",name:"手機",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":t["手機"]}]),placeholder:"請輸入手機",rules:r.isPhone,modelValue:i.form.user.tel,"onUpdate:modelValue":e[2]||(e[2]=t=>i.form.user.tel=t)},null,8,["class","rules","modelValue"]),(0,l.Wm)(c,{name:"手機",class:"invalid-feedback"})]),(0,l._)("div",ut,[mt,(0,l.Wm)(n,{id:"address",name:"地址",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":t["地址"]}]),placeholder:"請輸入地址",rules:"required",modelValue:i.form.user.address,"onUpdate:modelValue":e[3]||(e[3]=t=>i.form.user.address=t)},null,8,["class","modelValue"]),(0,l.Wm)(c,{name:"地址",class:"invalid-feedback"})]),(0,l._)("div",pt,[ht,(0,l.wy)((0,l._)("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[4]||(e[4]=t=>i.form.message=t)},null,512),[[d.nr,i.form.message]])]),(0,l._)("div",gt,[(0,l._)("button",{type:"submit",class:"btn btn-danger",onClick:e[5]||(e[5]=(0,d.iM)((t=>r.sendOrder()),["prevent"]))}," 送出訂單 ")])])),_:1},512)])}var bt={data(){return{form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{isPhone(t){const e=/^(09)[0-9]{8}$/;return!!e.test(t)||"需要正確的電話號碼"},sendOrder(){const t="https://vue3-course-api.hexschool.io/v2/api/mimiluckying/order",e={user:this.form.user,message:this.form.message};console.log(e),this.$http.post(t,{data:e}).then((t=>{alert(t.data.message),console.log(t),this.$refs.form.resetForm()})).catch((t=>{console.log(t)}))}}};const vt=(0,tt.Z)(bt,[["render",_t]]);var ft=vt,yt={data(){return{cartData:{},products:[],product:{},deleteAllCarts:{},cart:{},productId:"",isLoading:"",form:{user:{email:"",name:"",address:"",tel:""},message:""}}},components:{CartForm:ft,CartModal:at},methods:{getProducts(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/mimiluckying/products/all").then((t=>{this.products=t.data.products})).catch((t=>{alert(t.data.message)}))},getCarts(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/mimiluckying/cart").then((t=>{this.cartData=t.data.data})).catch((t=>{alert(t.data.message)}))},addToCart(t,e=1){const a={product_id:t,qty:e};this.isLoading=t,this.$http.post("https://vue3-course-api.hexschool.io/v2/api/mimiluckying/cart",{data:a}).then((t=>{this.getCarts(),this.isLoading="",lt.Z.emit("get-cart")})).catch((t=>{alert(t.data.message)}))},delCartItem(t){this.isLoading=t,this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/mimiluckying/cart/${t}`).then((t=>{this.getCarts(),this.isLoading="",lt.Z.emit("get-cart")})).catch((t=>{alert(t.data.message)}))},delCarts(){this.$http.delete("https://vue3-course-api.hexschool.io/v2/api/mimiluckying/carts").then((t=>{alert("已成功清除購物車"),this.getCarts(),lt.Z.emit("get-cart")})).catch((t=>{alert(t.data.message)}))},updateCarts(t){const e={product_id:t.id,qty:t.qty};this.isLoading=t.id,this.$http.put(`https://vue3-course-api.hexschool.io/v2/api/mimiluckying/cart/${t.id}`,{data:e}).then((t=>{this.getCarts(),this.isLoading=""})).catch((t=>{alert(t.data.message)}))},openModal(t){this.$refs.CartModal.openModal(),this.productId=t,this.$refs.CartModal.getProduct()}},mounted(){this.getProducts(),this.getCarts()}};const wt=(0,tt.Z)(yt,[["render",W]]);var Ct=wt}}]);
//# sourceMappingURL=485.376dbfd7.js.map